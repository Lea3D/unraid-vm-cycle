Menu="Utilities"
Icon="vm-cycle.png"
Title="vm-cycle"
---
<?php
$vmcyclevmsetup = parse_ini_file("/boot/config/plugins/vm-cycle/vmcyclesettings",true);
//VM Setup
$vmcyclevmsetup_vm1 = isset($vmcyclevmsetup['VM1']) ? $vmcyclevmsetup['VM1'] : "";
$vmcyclevmsetup_vm2 = isset($vmcyclevmsetup['VM2']) ? $vmcyclevmsetup['VM2'] : "";
//VM Docker Setup
$vmcyclevmsetup_vmdocker = isset($vmcyclevmsetup['VMD']) ? $vmcyclevmsetup['VMD'] : "";
$vmcyclevmsetup_docker = isset($vmcyclevmsetup['DOCKERS']) ? $vmcyclevmsetup['DOCKERS'] : "";
?>

<script>
function send(command) {
  if(command == "start"){
    document.getElementById("command").value = "/usr/local/emhttp/plugins/vm-cycle/scripts/start";
  } else if( command == "startdocker" ){
    document.getElementById("command").value = "/usr/local/emhttp/plugins/vm-cycle/scripts/startdocker";
  }
  document.getElementById("form").submit();
}

function loadVmTable() {
  fetch('/plugins/dynamix.vm.manager/include/VMMachines.php')
    .then(response => response.text())
    .then(data => {
      const [tableHtml] = data.split('\0');
      document.getElementById('vm-table-body').innerHTML = tableHtml;
    });
}

window.onload = loadVmTable;
</script>

<div style="display: flex; justify-content: center;">
  <table style="border-collapse: collapse; width: auto; max-width: 1000px; margin: 0 auto;">
    <thead>
      <tr>
        <th style="text-align: center; padding: 0.5em;">Icon</th>
        <th style="text-align: left; padding: 0.5em 1em;">VM Name</th>
        <th style="text-align: center; padding: 0.5em;">Status</th>
        <th style="text-align: center; padding: 0.5em;">PCI</th>
        <th style="text-align: center; padding: 0.5em;">USB</th>
        <th style="text-align: left; padding: 0.5em;">Graphics</th>
      </tr>
    </thead>
    <tbody id="vm-table-body">
      <tr><td colspan="6" style="text-align: center;">Loading...</td></tr>
    </tbody>
  </table>
</div>

<form markdown="1" id="form" method="POST" action="/update.php" target="progressFrame">
<input type="hidden" id="file" name="#file" value="/boot/config/plugins/vm-cycle/vmcyclesettings" />
<input type="hidden" id="command" name="#command" value="" />

<div class="title"><span class="left"><i class="fa fa-hand-peace-o title"></i>Cycle VM vs VM</span></div>

VM 1:
: <select name="VM1" class="narrow">
    <?php foreach ($lv->get_domains() as $vm): ?>
        <option value="<?= $vm ?>" <?= $vm == $vmcyclevmsetup_vm1 ? 'selected' : '' ?>><?= $vm ?></option>
    <?php endforeach; ?>
  </select>
    <blockquote class='inline_help'>
        <p>set your first VM Name here to cycle, sequence doesn't matter</p>
    </blockquote>

VM 2:
: <select name="VM2" class="narrow">
    <?php foreach ($lv->get_domains() as $vm): ?>
        <option value="<?= $vm ?>" <?= $vm == $vmcyclevmsetup_vm2 ? 'selected' : '' ?>><?= $vm ?></option>
    <?php endforeach; ?>
  </select>
    <blockquote class='inline_help'>
        <p>set your second VM Name here to cycle, sequence doesn't matter</p>
    </blockquote>

<div style="text-align: center;">
    <input type="button" value="Apply" onClick="send('apply')">
    <input type="button" value="Cycle VMs" onClick="send('start')">
</div>

<div class="title"><span class="left"><i class="fa fa-hand-peace-o title"></i>Cycle VM vs Docker/s</span></div>

VM:
: <input type="text" name="VMD" class="narrow" maxlength="50" value="<?=$vmcyclevmsetup_vmdocker;?>" placeholder="VM Name" >
    <blockquote class='inline_help'>
        <p>set your VM Name here to cycle</p>
		<p>if the VM is running, we stop the VM, start the Dockers, if VM is off, vice versa</p>
    </blockquote>

DOCKER:
: <input type="text" name="DOCKERS" class="narrow" maxlength="50" value="<?=$vmcyclevmsetup_docker;?>" placeholder="DOCKER Name/s" >
    <blockquote class='inline_help'>
        <p>set your Docker Name/s here to cycle, space separated, sequence doesn't matter</p>
    </blockquote>

<div style="text-align: center;">
    <input type="button" value="Apply" onClick="send('apply')">
    <input type="button" value="Cycle VM Docker" onClick="send('startdocker')">
</div>

</form>
